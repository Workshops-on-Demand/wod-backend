#!/bin/bash

set -x

# Caller must define TMPDIR, WODRTARGET and NAME so this script works correctly
mkdir -p $TMPDIR
# Retrieve *.ipynb files to compute completion ratio
ssh -q {{ NOCHECKSSH }} $WODRTARGET sudo su - student$stdid -c \'docker exec $NAME${stdid}_$NAME${stdid}_1 tar cf /tmp/ipynb.tar .\'
ssh -q {{ NOCHECKSSH }} $WODRTARGET sudo su - student$stdid -c \'mkdir -p $TMPDIR\'
ssh -q {{ NOCHECKSSH }} $WODRTARGET sudo su - student$stdid -c \'docker cp $NAME${stdid}_$NAME${stdid}_1:/tmp/ipynb.tar $TMPDIR\'
scp -q {{ NOCHECKSSH }} $WODRTARGET:$TMPDIR/ipynb.tar $TMPDIR
chmod 755 $TMPDIR
chmod 644 $TMPDIR/ipynb.tar
sudo su - student$stdid -c "cd {{ WODSTUDDIR }}/student$stdid/$w ; tar xf $TMPDIR/ipynb.tar"
ssh -q {{ NOCHECKSSH }} $WODRTARGET sudo rm -rf $TMPDIR
rm -rf $TMPDIR
exit 0
