#!/usr/local/bin/pwsh
#
# script to reset OneView backend
#Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -Confirm:$false
#
Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -DisplayDeprecationWarnings $false -Scope AllUsers -Confirm:$false

$servername = "{{ VCENTERAPP }}"
$username = "{{ VCENTERADMIN }}"
$password = "{{ VCENTERPWD }}"
#Reverting HPE OneView Simulator 3 VM
#Set Vm name as variable
$vmsimu3 = "{{ OVVMSIMU3 }}"
#Reverting HPE OneView Simulator 4 VM
#Set Vm name as variable
$vmsimu4 = "{{ OVVMSIMU4 }}"

#-------------------------------------------------------------
#Connect to Vcenter appliance :
connect-viserver $servername -username $username -password $password
#Get snapshot name from OVVMSIMU3
$snap3 = Get-Snapshot -VM $vmsimu3
#Revert to snapshot
#Reverting snap $snap3"
Set-VM -VM $vmsimu3 -SnapShot $snap3 -Confirm:$false
#Get snapshot name from OVMSIMU4
$snap4 = Get-Snapshot -VM $vmsimu4
#Revert to snapshot
#Reverting snap $snap4"
Set-VM -VM $vmsimu4 -SnapShot $snap4 -Confirm:$false

exit
